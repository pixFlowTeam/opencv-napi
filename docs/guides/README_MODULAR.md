# OpenCV NAPI æ¨¡å—åŒ–ç»‘å®šæ¶æ„

## ğŸ¯ æ¦‚è¿°

æˆ‘ä»¬å·²ç»æˆåŠŸé‡æ„äº†OpenCV Node.js NAPIç»‘å®šï¼Œé‡‡ç”¨äº†æ¨¡å—åŒ–çš„æ¶æ„è®¾è®¡ã€‚è¿™ç§æ–°çš„æ¶æ„å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- **ğŸ“ æ¸…æ™°çš„æ¨¡å—åˆ†ç¦»** - æ¯ä¸ªOpenCVæ¨¡å—éƒ½æœ‰ç‹¬ç«‹çš„ç›®å½•å’Œæ–‡ä»¶
- **ğŸ”§ æ˜“äºç»´æŠ¤** - åŠŸèƒ½æŒ‰APIåˆ†ç»„ï¼Œä¾¿äºå®šä½å’Œä¿®æ”¹
- **âš¡ å¯æ‰©å±•æ€§** - æ–°åŠŸèƒ½å¯ä»¥è½»æ¾æ·»åŠ åˆ°å¯¹åº”æ¨¡å—ä¸­
- **ğŸ§ª æµ‹è¯•å‹å¥½** - å¯ä»¥ç‹¬ç«‹æµ‹è¯•å„ä¸ªæ¨¡å—çš„åŠŸèƒ½
- **ğŸ‘¥ å›¢é˜Ÿåä½œ** - å¤šäººå¯ä»¥å¹¶è¡Œå¼€å‘ä¸åŒæ¨¡å—

## ğŸ“‚ ç›®å½•ç»“æ„

```
src/napi_opencv/                    # æ¨¡å—åŒ–NAPIç»‘å®šç›®å½•
â”œâ”€â”€ common/                         # é€šç”¨å·¥å…·å’Œç±»å‹è½¬æ¢å™¨
â”‚   â”œâ”€â”€ type_converters.h           # æ‰€æœ‰ç±»å‹è½¬æ¢å™¨å£°æ˜
â”‚   â”œâ”€â”€ type_converters.cpp         # ç±»å‹è½¬æ¢å™¨å®ç°
â”‚   â””â”€â”€ safe_call.h                 # SafeCallå¼‚å¸¸å®‰å…¨åŒ…è£…å™¨
â”‚
â”œâ”€â”€ core/                           # Coreæ¨¡å— - åŸºç¡€æ•°å­¦å’Œæ•°ç»„æ“ä½œ
â”‚   â”œâ”€â”€ core.h                      # Coreæ¨¡å—å‡½æ•°å£°æ˜
â”‚   â””â”€â”€ core.cpp                    # Coreæ¨¡å—å®ç°
â”‚
â”œâ”€â”€ imgproc/                        # å›¾åƒå¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ imgproc.h                   # IMGPROCæ¨¡å—å‡½æ•°å£°æ˜
â”‚   â””â”€â”€ imgproc.cpp                 # IMGPROCæ¨¡å—å®ç°ï¼ˆå«3ä¸ªå·²å®ç°å‡½æ•°ï¼‰
â”‚
â”œâ”€â”€ imgcodecs/                      # å›¾åƒç¼–è§£ç æ¨¡å—
â”‚   â”œâ”€â”€ imgcodecs.h                 # IMGCODECSæ¨¡å—å‡½æ•°å£°æ˜
â”‚   â””â”€â”€ imgcodecs.cpp               # IMGCODECSæ¨¡å—å®ç°ï¼ˆå«2ä¸ªå·²å®ç°å‡½æ•°ï¼‰
â”‚
â”œâ”€â”€ objdetect/                      # ç›®æ ‡æ£€æµ‹æ¨¡å—
â”‚   â”œâ”€â”€ objdetect.h                 # çº§è”åˆ†ç±»å™¨ã€HOGã€QRç æ£€æµ‹ç­‰
â”‚   â””â”€â”€ objdetect.cpp
â”‚
â”œâ”€â”€ features2d/                     # ç‰¹å¾æ£€æµ‹æ¨¡å—
â”‚   â”œâ”€â”€ features2d.h                # SIFTã€ORBã€ç‰¹å¾åŒ¹é…ç­‰
â”‚   â””â”€â”€ features2d.cpp
â”‚
â”œâ”€â”€ photo/                          # è®¡ç®—æ‘„å½±æ¨¡å—
â”‚   â”œâ”€â”€ photo.h                     # å»å™ªã€HDRã€æ— ç¼å…‹éš†ç­‰
â”‚   â””â”€â”€ photo.cpp
â”‚
â”œâ”€â”€ calib3d/                        # ç›¸æœºæ ‡å®šæ¨¡å—
â”‚   â”œâ”€â”€ calib3d.h                   # ç›¸æœºæ ‡å®šã€ç«‹ä½“è§†è§‰ã€3Dé‡å»ºç­‰
â”‚   â””â”€â”€ calib3d.cpp
â”‚
â”œâ”€â”€ videoio/                        # è§†é¢‘I/Oæ¨¡å—
â”‚   â”œâ”€â”€ videoio.h                   # è§†é¢‘æ•è·å’Œå†™å…¥
â”‚   â””â”€â”€ videoio.cpp
â”‚
â”œâ”€â”€ flann/                          # FLANNå¿«é€Ÿæœç´¢æ¨¡å—
â”‚   â”œâ”€â”€ flann.h
â”‚   â””â”€â”€ flann.cpp
â”‚
â”œâ”€â”€ gapi/                           # G-APIå›¾è®¡ç®—æ¨¡å—
â”‚   â”œâ”€â”€ gapi.h
â”‚   â””â”€â”€ gapi.cpp
â”‚
â”œâ”€â”€ napi_opencv.h                   # ä¸»å¤´æ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰æ¨¡å—
â””â”€â”€ napi_opencv.cpp                 # ä¸»å®ç°æ–‡ä»¶å’Œæ¨¡å—æ³¨å†Œå™¨
```

## ğŸš€ æ„å»ºå’Œæµ‹è¯•

### ä½¿ç”¨æ¨¡å—åŒ–æ„å»ºè„šæœ¬

```bash
# æ„å»ºæ¨¡å—åŒ–ç‰ˆæœ¬
./build_napi_modular.sh
```

### æ‰‹åŠ¨æ„å»º

```bash
# é…ç½®
node-gyp configure --binding=binding_napi_modular.gyp

# ç¼–è¯‘
node-gyp build --binding=binding_napi_modular.gyp
```

## ğŸ“‹ å½“å‰å®ç°çŠ¶æ€

### âœ… å·²å®Œæˆçš„åŠŸèƒ½

#### Coreæ¨¡å—ï¼ˆ8ä¸ªç³»ç»Ÿä¿¡æ¯å‡½æ•°å·²å®ç°ï¼‰
- `getBuildInformation()` - OpenCVæ„å»ºä¿¡æ¯
- `getNumThreads()` / `setNumThreads()` - çº¿ç¨‹ç®¡ç†
- `getTickCount()` / `getTickFrequency()` - è®¡æ—¶åŠŸèƒ½
- `getVersionMajor/Minor/Revision()` - ç‰ˆæœ¬ä¿¡æ¯

#### IMGPROCæ¨¡å—ï¼ˆ3ä¸ªå‡½æ•°å·²å®ç°ï¼‰
- `resize()` - å›¾åƒç¼©æ”¾
- `gaussianBlur()` - é«˜æ–¯æ»¤æ³¢
- `cvtColor()` - é¢œè‰²ç©ºé—´è½¬æ¢

#### IMGCODECSæ¨¡å—ï¼ˆ2ä¸ªå‡½æ•°å·²å®ç°ï¼‰
- `imread()` - è¯»å–å›¾åƒ
- `imwrite()` - å†™å…¥å›¾åƒ

### ğŸ”§ æ¥å£è¦†ç›–ç‡

| æ¨¡å— | å·²å£°æ˜æ¥å£æ•° | å·²å®ç°æ•° | è¦†ç›–ç‡ | çŠ¶æ€ |
|------|-------------|----------|--------|------|
| Core | 50+ | 8 | 16% | ğŸŸ¡ éƒ¨åˆ†å®ç° |
| IMGPROC | 70+ | 3 | 4% | ğŸŸ¡ éƒ¨åˆ†å®ç° |
| IMGCODECS | 6 | 2 | 33% | ğŸŸ¡ éƒ¨åˆ†å®ç° |
| OBJDETECT | 12+ | 0 | 0% | ğŸ”´ å¾…å®ç° |
| FEATURES2D | 20+ | 0 | 0% | ğŸ”´ å¾…å®ç° |
| PHOTO | 15+ | 0 | 0% | ğŸ”´ å¾…å®ç° |
| CALIB3D | 20+ | 0 | 0% | ğŸ”´ å¾…å®ç° |
| VIDEOIO | 15+ | 0 | 0% | ğŸ”´ å¾…å®ç° |
| FLANN | 6+ | 0 | 0% | ğŸ”´ å¾…å®ç° |
| GAPI | 4+ | 0 | 0% | ğŸ”´ å¾…å®ç° |

**æ€»ä½“è¦†ç›–ç‡**: ~5% (13ä¸ªå‡½æ•°å·²å®ç° / çº¦250ä¸ªå·²å£°æ˜æ¥å£)

## ğŸ›  å¼€å‘æŒ‡å—

### æ·»åŠ æ–°å‡½æ•°å®ç°

1. **æ‰¾åˆ°å¯¹åº”æ¨¡å—æ–‡ä»¶**
   ```cpp
   // ä¾‹å¦‚ï¼šåœ¨ src/napi_opencv/core/core.cpp ä¸­
   Napi::Value Add(const Napi::CallbackInfo &info)
   {
       return SafeCall(info.Env(), [&]() -> Napi::Value {
           // å®ç° cv::add åŠŸèƒ½
           // ä½¿ç”¨ TypeConverter è¿›è¡Œç±»å‹è½¬æ¢
           // è¿”å›ç»“æœ
       });
   }
   ```

2. **ä½¿ç”¨ç±»å‹è½¬æ¢å™¨**
   ```cpp
   // ä»JavaScriptè·å–å‚æ•°
   cv::Mat src1 = TypeConverter<cv::Mat>::FromNapi(info[0]);
   cv::Mat src2 = TypeConverter<cv::Mat>::FromNapi(info[1]);
   
   // è°ƒç”¨OpenCVå‡½æ•°
   cv::Mat dst;
   cv::add(src1, src2, dst);
   
   // è¿”å›ç»“æœåˆ°JavaScript
   return TypeConverter<cv::Mat>::ToNapi(info.Env(), dst);
   ```

3. **åˆ é™¤å ä½ç¬¦å®ç°**
   ```cpp
   // åˆ é™¤è¿™è¡Œ
   PLACEHOLDER_IMPL(Add)
   ```

### æ·»åŠ æ–°çš„ç±»å‹è½¬æ¢å™¨

åœ¨ `src/napi_opencv/common/type_converters.h` å’Œ `.cpp` ä¸­æ·»åŠ æ–°ç±»å‹çš„è½¬æ¢å™¨ã€‚

### æ¨¡å—é—´ä¾èµ–

æ‰€æœ‰æ¨¡å—éƒ½å¯ä»¥ä½¿ç”¨ `common/` ç›®å½•ä¸‹çš„å·¥å…·ï¼š
- `TypeConverter<T>` - ç±»å‹è½¬æ¢
- `SafeCall()` - å¼‚å¸¸å®‰å…¨åŒ…è£…

## ğŸ¯ åç»­å¼€å‘è®¡åˆ’

### é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³å®ç°ï¼‰
1. **Coreæ¨¡å—åŸºç¡€è¿ç®—**: `add()`, `subtract()`, `multiply()`, `divide()`
2. **IMGPROCåŸºç¡€æ»¤æ³¢**: `blur()`, `medianBlur()`, `bilateralFilter()`
3. **IMGPROCè¾¹ç¼˜æ£€æµ‹**: `canny()`, `sobel()`, `laplacian()`
4. **IMGPROCå½¢æ€å­¦**: `erode()`, `dilate()`, `morphologyEx()`

### ä¸­ä¼˜å…ˆçº§ï¼ˆç¬¬äºŒé˜¶æ®µï¼‰
1. **FEATURES2DåŸºç¡€**: SIFTã€ORBæ£€æµ‹å™¨å’ŒåŒ¹é…å™¨
2. **PHOTOå»å™ª**: fastNlMeansDenoisingç³»åˆ—
3. **CALIB3DåŸºç¡€**: ç›¸æœºæ ‡å®šæ ¸å¿ƒåŠŸèƒ½
4. **IMGCODECS**: imdecodeã€imencode

### ä½ä¼˜å…ˆçº§ï¼ˆåç»­å®ç°ï¼‰
1. **VIDEOIO**: è§†é¢‘è¯»å†™åŠŸèƒ½
2. **FLANN**: å¿«é€Ÿæœç´¢åŠŸèƒ½
3. **GAPI**: å›¾è®¡ç®—API
4. **é«˜çº§åŠŸèƒ½**: å¤æ‚çš„è®¡ç®—æœºè§†è§‰ç®—æ³•

## ğŸ“Š ä¸åŸç‰ˆæœ¬å¯¹æ¯”

| ç‰¹æ€§ | åŸç‰ˆæœ¬ | æ¨¡å—åŒ–ç‰ˆæœ¬ |
|------|--------|------------|
| æ¶æ„ | å•ä¸€å¤§æ–‡ä»¶ | æ¨¡å—åŒ–åˆ†ç¦» |
| å¯ç»´æŠ¤æ€§ | å›°éš¾ | å®¹æ˜“ |
| å›¢é˜Ÿåä½œ | å†²çªé¢‘ç¹ | å¹¶è¡Œå¼€å‘ |
| åŠŸèƒ½æ‰©å±• | å¤æ‚ | ç®€å• |
| ç¼–è¯‘é€Ÿåº¦ | æ…¢ | æ›´å¿«ï¼ˆå¢é‡ç¼–è¯‘ï¼‰ |
| ä»£ç å®šä½ | å›°éš¾ | ç®€å• |

## ğŸ”— ä½¿ç”¨ç¤ºä¾‹

```javascript
const opencv = require('./build/Release/opencv_napi.node');

// ç³»ç»Ÿä¿¡æ¯
console.log('OpenCVç‰ˆæœ¬:', opencv.version);
console.log('çº¿ç¨‹æ•°:', opencv.getNumThreads());

// å›¾åƒå¤„ç†
const image = opencv.imread('input.jpg');
const resized = opencv.resize(image, {width: 640, height: 480});
const gray = opencv.cvtColor(resized, 6); // BGR2GRAY
const blurred = opencv.gaussianBlur(gray, {width: 5, height: 5}, 1.0);
opencv.imwrite('output.jpg', blurred);
```

---

è¿™ä¸ªæ¨¡å—åŒ–æ¶æ„ä¸ºOpenCV Node.jsç»‘å®šæä¾›äº†åšå®çš„åŸºç¡€ï¼Œä½¿å¾—åç»­å¼€å‘æ›´åŠ é«˜æ•ˆå’Œæœ‰åºã€‚æ¯ä¸ªå¼€å‘è€…å¯ä»¥ä¸“æ³¨äºç‰¹å®šæ¨¡å—çš„å®ç°ï¼Œå¤§å¤§æé«˜äº†å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚